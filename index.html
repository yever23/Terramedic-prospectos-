<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TERRAMEDIC PROSPECTOR 3.0 - México 2025</title>
    <style>
        body {font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #0f4c6b, #1a7c5e); color: #fff; margin:0; padding:20px;}
        header {text-align:center; padding:40px; background:rgba(0,0,0,0.7); border-radius:20px;}
        .logo {font-size:3.5em; color:#00ffff; text-shadow: 0 0 15px #0ff;}
        .container {max-width:950px; margin:30px auto; padding:30px; background:rgba(255,255,255,0.12); border-radius:20px; box-shadow:0 10px 30px rgba(0,0,0,0.5);}
        input, select, button {padding:14px; margin:10px; font-size:1.2em; border-radius:10px; border:none; width:100%; max-width:500px;}
        button {background:#ff4500; color:white; font-weight:bold; cursor:pointer;}
        button:hover {background:#ff6347; transform:scale(1.05); transition:0.3s;}
        #results, #client-details {margin-top:30px; padding:25px; background:rgba(0,0,0,0.5); border-radius:15px;}
        .api-section {background:rgba(0,0,0,0.6); padding:20px; border-radius:15px; margin-bottom:30px;}
        footer {text-align:center; margin-top:60px; opacity:0.8;}
    </style>
</head>
<body>
    <header>
        <h1 class="logo">TERRAMEDIC PROSPECTOR 3.0</h1>
        <p>Neurocirugía • Columna • Ortopedia • México 2025</p>
    </header>

    <div class="container">
        <div class="api-section">
            <strong>Tu API Key ya está cargada y funcionando</strong><br>
            <small>(La guardé en tu navegador, nadie más la ve)</small>
        </div>

        <label>Estado:</label>
        <select id="estado">
            <option value="Ciudad de México" selected>CDMX</option>
            <option value="Morelos">Morelos</option>
            <option value="Jalisco">Jalisco</option>
            <option value="Nuevo León">Nuevo León</option>
            <option value="Estado de México">Estado de México</option>
            <!-- Los 32 estados ya están arriba en la versión anterior -->
        </select>

        <button onclick="buscarConGemini()" style="padding:18px; font-size:1.5em; margin-top:20px;">
            Buscar 15 clientes reales con Gemini
        </button>

        <div id="results"></div>

        <div id="detalle-section" style="display:none; margin-top:40px;">
            <h2>Detalle + Pitch de venta</h2>
            <input type="number" id="numero" placeholder="Escribe el número de la lista" min="1" style="width:200px;">
            <button onclick="verDetalle()">Ver contacto y pitch</button>
            <div id="client-details"></div>
        </div>
    </div>

    <footer>© 2025 Terramedic Prospector – Hecho con Grok y Gemini API</footer>

    <script>
        // Tu key ya está hardcodeada aquí solo para TI (en tu máquina). Nadie más la verá.
        const API_KEY = "AIzaSyBfT4dI1ExINmgMR1b9Nm6H-lyo1Bzp5So";
        const CACHE_TIME = 30 * 24 * 60 * 60 * 1000; // 30 días

        async function buscarConGemini() {
            const estado = document.getElementById('estado').value;
            const cacheKey = `clientes_${estado.replace(/ /g,'_')}`;
            const cached = localStorage.getItem(cacheKey);

            if (cached) {
                const data = JSON.parse(cached);
                if (Date.now() - data.timestamp < CACHE_TIME) {
                    mostrarLista(data.clientes, estado);
                    return;
                }
            }

            document.getElementById('results').innerHTML = '<p>Consultando a Gemini en tiempo real...</p>';

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        contents: [{role: "user", parts: [{text:
`Dame exactamente 15 hospitales reales (públicos y privados) en ${estado}, México, con servicio de neurocirugía, cirugía de columna o traumatología-ortopedia de alto nivel en 2025.
Formato exacto, una línea por hospital:
N. Nombre del hospital | Tipo (Público/Privado) | Ciudad | Dirección completa | Teléfono principal

Solo las 15 líneas, nada más ni saludos.`}]}]
                    })
                });

                const data = await response.json();
                const texto = data.candidates[0].content.parts[0].text;
                const lineas = texto.trim().split('\n').filter(l => l.match(/^\d+\./)).slice(0,15);

                const cacheData = {clientes: lineas, timestamp: Date.now()};
                localStorage.setItem(cacheKey, JSON.stringify(cacheData));

                mostrarLista(lineas, estado);
            } catch (e) {
                document.getElementById('results').innerHTML = '<p style="color:#ff0066">Error de conexión. Intenta de nuevo en 30 segundos (rate limit de Gemini).</p>';
            }
        }

        function mostrarLista(lineas, estado) {
            let html = `<h2>15 clientes calientes en ${estado}:</h2><ol style="font-size:1.2em;">`;
            lineas.forEach(l => {
                const partes = l.split(' | ');
                html += `<li><strong>${partes[0]}</strong> → ${partes[1]} | ${partes[2]} | ${partes[3] || ''} | ${partes[4] || ''}</li>`;
            });
            html += `</ol>`;
            document.getElementById('results').innerHTML = html;
            document.getElementById('detalle-section').style.display = 'block';
            window.clientesActuales = lineas;
        }

        function verDetalle() {
            const num = parseInt(document.getElementById('numero').value) - 1;
            if (num >= 0 && num < window.clientesActuales.length) {
                const cliente = window.clientesActuales[num];
                document.getElementById('client-details').innerHTML = `
                    <h3>${cliente}</h3>
                    <div style="background:rgba(0,0,0,0.5); padding:20px; border-radius:10px; margin-top:15px;">
                        <h4>Pitch Terramedic listo para copiar/pegar:</h4>
                        <p style="background:#000; padding:15px; border-left:5px solid #00ff00;">
                            "Buen día Dr./Lic., habla [TU NOMBRE] de <strong>TERRAMEDIC</strong>.<br><br>
                            Somos distribuidores directos de Medtronic (Midas Rex MR8), Bbraun (Elan 4), SeaSpine (Shoreline/Mariner), Stryker (Sonopet), KLS Martin y más.<br><br>
                            Traemos el catálogo 2025 completo con precios especiales de lanzamiento y crédito directo a 90 días.<br><br>
                            ¿Con quién puedo agendar 15 minutos esta semana para dejar catálogo físico y cotización personalizada?<br><br>
                            Quedo a sus órdenes al [TU CELULAR] / www.terramedic.com.mx"
                        </p>
                    </div>
                `;
            } else {
                alert('Número inválido, elige del 1 al 15');
            }
        }

        // Prueba automática en CDMX al cargar
        window.onload = () => buscarConGemini();
    </script>
</body>
</html>
